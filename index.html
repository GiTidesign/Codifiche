<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultatore LEA Avanzato: Serie & Su Misura (Chiuso di Default)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .device-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%; /* Assicura che le card abbiano la stessa altezza nella griglia */
        }
        .device-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
        .section-title {
            border-bottom: 2px solid #0ea5e9; /* sky-500 */
            padding-bottom: 8px;
            margin-bottom: 16px;
            cursor: pointer; /* Indica che è cliccabile */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-title .arrow {
            transition: transform 0.3s ease;
        }
        .section-title.collapsed .arrow {
            transform: rotate(-90deg);
        }
        .device-grid-container {
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out, margin-bottom 0.5s ease-out;
            overflow: hidden;
            max-height: 4000px; /* Aumentato per contenere più dati, aggiustare se necessario */
            opacity: 1;
        }
        .device-grid-container.hidden {
            max-height: 0;
            opacity: 0;
            margin-bottom: 0 !important; /* Rimuove il margine quando collassato */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-sky-700">Codifiche LEA Ortopedia Ruggiero</h1>
            <p class="text-gray-600 mt-2">Esplora dispositivi "Di Serie" e "Su Misura".</p>
        </header>

        <div class="mb-8">
            <input type="text" id="searchInput"
                   class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-shadow"
                   placeholder="Cerca per nome prodotto, marca, codice LEA, categoria o patologia...">
        </div>

        <!-- Sezione Ortesi di Serie -->
        <section id="sectionSerieWrapper" class="mb-12">
            <h2 id="toggleSerie" class="text-2xl font-semibold text-sky-700 section-title">
                <span>Ortesi di Serie</span>
                <span class="arrow text-sky-700">&#9660;</span>
            </h2>
            <div id="devicesContainerSerieWrapper" class="device-grid-container">
                <div id="devicesContainerSerie" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
                    <!-- Le card dei dispositivi DI SERIE verranno inserite qui -->
                </div>
            </div>
            <p id="noResultsSerie" class="hidden text-center text-gray-500 mt-6">Nessun dispositivo "Di Serie" trovato per questa ricerca.</p>
        </section>

        <!-- Sezione Ortesi su Misura -->
        <section id="sectionSuMisuraWrapper" class="mb-12">
            <h2 id="toggleSuMisura" class="text-2xl font-semibold text-teal-700 section-title">
                <span>Ortesi su Misura</span>
                <span class="arrow text-teal-700">&#9660;</span>
            </h2>
            <div id="devicesContainerSuMisuraWrapper" class="device-grid-container">
                <div id="devicesContainerSuMisura" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
                    <!-- Le card dei dispositivi SU MISURA verranno inserite qui -->
                </div>
            </div>
            <p id="noResultsSuMisura" class="hidden text-center text-gray-500 mt-6">Nessun dispositivo "Su Misura" trovato per questa ricerca.</p>
        </section>
        
        <div id="noResultsGlobal" class="hidden text-center text-gray-500 mt-10">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="mt-2 text-xl">Nessun risultato trovato in nessuna categoria.</p>
            <p>Prova a modificare i termini di ricerca.</p>
        </div>

        <footer class="mt-12 text-center text-sm text-gray-500">
            <p>Dati estratti dai documenti PDF forniti. Verifica sempre con fonti ufficiali.</p>
            <p>&copy; 2024 App Consultazione LEA</p>
        </footer>
    </div>

    <script>
        const allDevicesData = [
          // --- DISPOSITIVI DI SERIE (dal PDF ORTESI_DI_SERIE.pdf) ---
          { prodotto: "Spry Step Max / Toe off (Tutore gamba piede in carbonio)", marca: "Thuasne", codiciLEA: ["06.12.06.018 760"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "Patologie neurologiche; Tutore per piede cadente;" },
          { prodotto: "Spry Step / Walk on (Tutore gamba piede in carbonio)", marca: "thuasne ottobock", codiciLEA: ["06.12.06.018 760"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "Patologie neurologiche; Tutore per piede cadente;" },
          { prodotto: "Dynamic Walk (Tutore gamba piede in carbonio)", marca: "Centri", codiciLEA: ["06.12.06.018 760"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "Patologie neurologiche; Tutore per piede cadente;" },
          { prodotto: "Pero-Med (Tutore gamba piede basso)", marca: "Thuasne", codiciLEA: ["06.12.06.033 90"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "Patologie neurologiche; Tutore per piede cadente; Piede flaccido; Paresi peroneale;" },
          { prodotto: "Af Servo (Tutore gamba piede basso)", marca: "Smart reha", codiciLEA: ["061206042 111", "061291424 70", "061291517 21"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "Ictus, lesioni della colonna, charcot-marie-tooth" },
          { prodotto: "Dictus (Tutore gamba piede basso)", marca: "Podartis", codiciLEA: ["061206039 93", "061291218 87"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "equinismi spastici di media entità, cadute flaccide del piede" },
          { prodotto: "Malleo Neurexa (Tutore gamba piede basso)", marca: "Ottobock", codiciLEA: ["061206042 111", "061291424 70", "061291436 21,30"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "ictus, sclerosi multipla, patologie neurologiche" },
          { prodotto: "Push ortho (Tutore gamba piede basso flessibile)", marca: "Eumedica", codiciLEA: ["061206036 435", "061291517 21"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "Ridotto controllo dei muscoli elevatori del piede, instabilità di caviglia" },
          { prodotto: "Lift Foot (tutore gamba piede in elastico)", marca: "itop", codiciLEA: ["06.12.06.045 160", "06.12.91.436 21,30"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortedi Afo", patologie: "Piede cadente" },
          { prodotto: "Saebo Step (Tutore gamba piede basso)", marca: "Saebo", codiciLEA: ["061206036 435", "aggiuntivi per step kit barefoot: 061291424, 061291517"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi AFO", patologie: "Piede cadente" },
          { prodotto: "Air Soft (Tutore palmare per mano- polso)", marca: "Tielle", codiciLEA: ["060613009 345"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "Lesioni neurologiche dell'arto superiore con conseguenti paralisi spastiche o flaccide dell'arto superiore."},
          { prodotto: "Saebo Strech (Tutore palmare statico)", marca: "Saebo", codiciLEA: ["06.06.13.012 390", "06.06.91.103 62,40", "06.06.91.112 23", "06.06.91.106 125,80"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "Lesioni neurologiche dell'arto superiore con conseguenti paralisi spastiche."},
          { prodotto: "Saebo Glove (Guanto)", marca: "Saebo", codiciLEA: ["Non specificato nel PDF"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "lesioni neurologiche e ortopediche"},
          { prodotto: "Ginocchiera steccata", marca: "Non specificata", codiciLEA: ["Non specificato nel PDF"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi coscia gamba", patologie: "Lesioni a carico dei legamenti e meniscali"},
          { prodotto: "Ginocchiera articolata", marca: "Non specificata", codiciLEA: ["Non specificato nel PDF"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi coscia gamba", patologie: "Lesioni a carico dei legamenti e meniscali"},
          { prodotto: "Check (Ginocchiera per Recurvato)", marca: "Tielle", codiciLEA: ["06.12.09.036 435"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi coscia gamba", patologie: "iperestensione di ginocchio"},
          { prodotto: "Tutore Articolato di gomito", marca: "Tielle", codiciLEA: ["06.06.15.018*"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "fratture composte di gomito, lussazione o sub-lussazione del gomito"},
          { prodotto: "Tutore Di spalla", marca: "Tielle", codiciLEA: ["06.06.30.033*"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "Spalla cadente"},
          { prodotto: "Minerva/ Headmaster (Collare Rigido)", marca: "Tielle", codiciLEA: ["Non specificato nel PDF"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi cervicale", patologie: "Instabilità del tratto cervicale dovuta a patologie neurologiche (S.L.A.)"},
          { prodotto: "Toe walking", marca: "Non specificata", codiciLEA: ["061203051 145,60 (x2)", "061291523 173,90 (x2)", "+ calzature non contemplate"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Plantari e scarpe", patologie: "toe walking idiopatico (cammino sulle punte)"},
          { prodotto: "Spinfast (Busto in stoffa rigidi con spallacci)", marca: "TLM", codiciLEA: ["060309012(donna) 340", "060309009(uomo) 310", "060391124 41,50", "060391130 29,70"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "Osteoporosi, decorso post operatorio, post trauma, cedimenti vertebrali."},
          { prodotto: "Ipertex/ Crossover (Busto in stoffa con spallacci)", marca: "TLM", codiciLEA: ["060309003 (uomo) 260", "060309006 (DONNA) 270", "060391121 34,30"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "osteoporosi, artrosi lombare, ipercifosi, post trauma"},
          { prodotto: "C35 (Busto per iperestensione)", marca: "Tielle", codiciLEA: ["06.03.09.113 229"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinali", patologie: "fratture e cedimenti vertebrali"},
          { prodotto: "Summer, 555, 500W (Busto in stoffa lombare)", marca: "TLM", codiciLEA: ["060309003 (UOMO) 260", "060309006 (DONNA) 270"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "osteoporosi, artrosi lombare"},
          { prodotto: "MZ (Busto crocera rigida)", marca: "Non specificata", codiciLEA: ["060309047 844,80"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinali", patologie: "Non specificata"},
          { prodotto: "Busto Boston (Busto per scoliosi)", marca: "Non specificata", codiciLEA: ["060309092 1073,40", "opzionale placca: 060391403"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "scoliosi idiopatica giovanile"},
          { prodotto: "busto CLB (Busto per scoliosi)", marca: "Non specificata", codiciLEA: ["060309071 1106,80"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinali", patologie: "scoliosi idiopatica giovanile"},
          { prodotto: "Busto cheneau (busto per scoliosi)", marca: "Non specificata", codiciLEA: ["060309077 950"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "scoliosi idiopatica giovanile"},
          { prodotto: "Busto lionese (Busto scoliosi)", marca: "Non specificata", codiciLEA: ["060309059 1598"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinali", patologie: "scoliosi idiopatica giovanile"},
          { prodotto: "Busto lionese per dorso curvo (Busto scoliosi)", marca: "Non specificata", codiciLEA: ["060309062 1619,60"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "scoliosi idiopatica giovanile"},
          { prodotto: "Busto Sforzesco (Busto scoliosi)", marca: "Non specificata", codiciLEA: ["060309080 1509,10"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "scoliosi idiopatica giovanile"},
          { prodotto: "Vacuum Bell (Dispositivo per Petto escavato)", marca: "Non specificata", codiciLEA: ["060309077 950", "060391406 90"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "petto escavato"},
          { prodotto: "Busto Milwaukee (Busto scoliosi)", marca: "Non specificata", codiciLEA: ["060318003 1044,70", "opzionali: 060391603, 060391606"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi Spinali", patologie: "scoliosi idiopatica giovanile"},
          { prodotto: "Corsetto compressivo dinamico (CDC) (Busto scoliosi)", marca: "Non specificata", codiciLEA: ["60309110 570", "060391403 140"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi Spinali", patologie: "petto carenato"},
          { prodotto: "Busto statico equilibrato", marca: "Non specificata", codiciLEA: ["060318033", "060391709", "numerosi opzionali"], tipoDispositivo: "Di Serie", categoriaOrtesi: "Ortesi spinali", patologie: "Non specificata"},
          { prodotto: "Scarpa di serie (Scarpe di serie e plantari per adulti)", marca: "Non specificata", codiciLEA: ["Vedere codici opzionali associati nel PDF"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "artrosi del piede, artrite reumatoide, piede diabetico prevenzione primaria"},
          { prodotto: "Scarpa di serie pediatrica (scarpe di serie e plantari per bambini)", marca: "Non specificata", codiciLEA: ["Vedere codici opzionali associati nel PDF"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "piede valgo piatto, ginocchio valgo"},
          { prodotto: "Bebax (Tutore per piede)", marca: "Tielle", codiciLEA: ["06.12.06.051 380", "opzionale asta: 061291430 N.L."], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "malformazioni dell'avampiede, metatarso varo-addotto-supinato, Post operatorio"},
          { prodotto: "Ponseti (Tutore per piede)", marca: "Tielle", codiciLEA: ["06.12.15.021 1150", "opzionale asta: 061291430 N.L."], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "piede torto congenito"},
          { prodotto: "Molla di Codivilla (tutore gamba piede)", marca: "Tielle", codiciLEA: ["061206042 111"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "piede cadente"},
          { prodotto: "Coxaflex / hipp med (Tutore per anca)", marca: "thuasne", codiciLEA: ["Non specificato nel PDF"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi d'anca", patologie: "Displasia congenita dell'anca"},
          { prodotto: "Coxa Fix (tutore d'anca)", marca: "Tielle", codiciLEA: ["06.12.15.012 720", "06.12.91.490 300"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortedi d'anca", patologie: "Artroplastica totale d'anca, fratture non consolidate del collo del femore, instabilità complesse dell'articolazione dell'anca."},
          { prodotto: "Plantari termoformabile", marca: "Non specificata", codiciLEA: ["06.12.03.024 84,10 (x2)", "06.12.91.103 1 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Plantari con talloniera avvolgente in multiform", marca: "Non specificata", codiciLEA: ["06.12.03.030 104 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Plantari con sistema Cad Cam", marca: "Non specificata", codiciLEA: ["06.12.03.042 138,40 (x2)", "06.12.91.103 1 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "plantari sensomotori", marca: "Non specificata", codiciLEA: ["061203042 138,40 (x2)", "061291103 1 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Piede piatto valgo"},
          { prodotto: "plantari su Calco gessato", marca: "Non specificata", codiciLEA: ["061203051 145,60 (x2)", "061291103 1 (x2)", "061291106 13,50 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "piede diabetico, piede deforme"},
          { prodotto: "Rialzo fino a 4 cm", marca: "Non specificata", codiciLEA: ["061203075 71,40"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Eterometria arti inferiori"},
          { prodotto: "rialzo da 4 a 8 cm", marca: "Non specificata", codiciLEA: ["061203078 83"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Eterometria arti inferiori"},
          { prodotto: "rialzo oltre gli 8 cm", marca: "Non specificata", codiciLEA: ["061203081 88,90"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Eterometria arti inferiori"},
          { prodotto: "Saebo step kit barefoot (ortesi di caviglia piede)", marca: "Non specificata", codiciLEA: ["061206036 435", "061291424 70", "061291517 21"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Hypex lite adulto/pediatrico (ortesi di ginocchio)", marca: "Albrecht", codiciLEA: ["061209024 595"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "ortesi di ginocchio jack PCL", marca: "Albrecht", codiciLEA: ["061209018 605", "061291230 46,50", "061291466 290 (x2)", "061291436 21,30 (x3)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Elbow track (ortesi di gomito)", marca: "Albrecht", codiciLEA: ["060615018 575,90", "060691203 285,70"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "Non specificata"},
          { prodotto: "CDS Knee brece flex/ext (ortesi di ginocchio dinamico)", marca: "Albrecht", codiciLEA: ["061209018 605", "061291466 290 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "CDS Knee brece amputation (ortesi di ginocchio dinamico)", marca: "Albrecht", codiciLEA: ["061209018 605", "061291466 290 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "CDS Ankle brace (ortesi gamba piede)", marca: "Albrecht", codiciLEA: ["061206027 543", "061291412 120 (x2)", "061291424 70", "061203024 84,10", "061291227 28", "061291505 80"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "CDS Elbow brace flex/ext (ortesi di gomito)", marca: "Albrecht", codiciLEA: ["060615018 605", "060691206 170", "060691203 285,70"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesiarto superiore", patologie: "Non specificata"},
          { prodotto: "CDS Wrist brace flex/ext (ortesi di polso dinamica)", marca: "Albrecht", codiciLEA: ["060613015 520", "060691103 62,40", "060691203 285,70", "060691106 125,50", "060691112 23"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "Non specificata"},
          { prodotto: "MKS lumbago plus (corsetto lombare)", marca: "Albrecht", codiciLEA: ["060309003 260", "opzionale: 60309006"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinale", patologie: "Non specificata"},
          { prodotto: "MKS Pontsana mobil (corsetto lombare)", marca: "Albrecht", codiciLEA: ["060309018 290", "opzionale: 60309015"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinale", patologie: "Non specificata"},
          { prodotto: "MKS Pontsana stabil (corsetto lombare)", marca: "Albrecht", codiciLEA: ["060309024 350", "060391115 6,90 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinale", patologie: "Non specificata"},
          { prodotto: "MKS Osteo plus (corsetto toraco lombare)", marca: "Albrecht", codiciLEA: ["060309021", "060391106", "060391121 (x2)", "060391115 (x2)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi spinale", patologie: "Non specificata"},
          { prodotto: "Guanto robotico", marca: "Non specificata", codiciLEA: ["060613012 390", "060691103 62,40", "060691118 26,80", "060691106 125,50", "060691112 23 (x5)"], tipoDispositivo: "Di Serie", categoriaOrtesi: "ortesi arto superiore", patologie: "Non specificata"},
          
          // --- DISPOSITIVI SU MISURA (dal PDF ORTESI_SU_MISURA.pdf) ---
          { prodotto: "Tutore gamba piede e T3-T4-T5", marca: "Non specificata", codiciLEA: ["06.12.06.027 543", "06.12.91.436 21,30 (x2)", "06.12.91.517 21"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi arto inferiori", patologie: "Paralisi cerebrali infantili, patologie neuromuscolari." },
          { prodotto: "Tutore nancy hilton T2", marca: "Non specificata", codiciLEA: ["06.12.06.036 435", "06.12.91.517 21"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi arto inferiore", patologie: "Paralisi cerebrali infantili, patologie neuromuscolari." },
          { prodotto: "Atlanta (Tutore Bacino coscia)", marca: "Non specificata", codiciLEA: ["06.12.15.009 1000", "06.12.91.493 470 (x2)", "06.12.91.508 75", "06.12.91.511 95", "06.12.91.436 21,30 (x4)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi d'anca", patologie: "Morbo di Perthes" },
          { prodotto: "Swash (Tutore bacino coscia)", marca: "Non specificata", codiciLEA: ["06.12.15.009 1000", "06.12.91.236 80", "06.12.91.436 21,30 (x4)", "06.12.91.484 190 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi per anca", patologie: "Non specificata"},
          { prodotto: "Doccia Gamba piede", marca: "Non specificata", codiciLEA: ["06.12.06.003 385", "06.12.91.218 55 (x3)", "06.12.91.227 40,50"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi arto inferiore", patologie: "Post operatorio, contenzione notturna."},
          { prodotto: "CaMO (Tutore Gamba piede a balestra)", marca: "Non specificata", codiciLEA: ["06.12.06.027 543", "06.12.91.436 21,30 (x2)", "06.12.91.418 70 (x6)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi arto inferiore", patologie: "Paralisi cerebrali infantili, mielomeningocele, stroke, forme diplegiche, tetraplegiche o emiplegiche"},
          { prodotto: "Doccia coscia gamba piede gin. Esteso", marca: "Non specificata", codiciLEA: ["06.12.12.003 549", "06.12.91.218 87,50 (x2)", "06.12.91.239 80", "06.12.91.221 50"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Non specificata", patologie: "Patologie neuromuscolari e mielomeningocele per lieve flessione del ginocchio."},
          { prodotto: "Doccia coscia gamba piede gin. Flesso", marca: "Non specificata", codiciLEA: ["06.12.12.012 487", "06.12.91.218* 87.50 (x2)", "06.12.91.239 80"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "Piede Torto Congenito, Tibia Vara."},
          { prodotto: "Tutore Coscia Gamba Piede", marca: "Non specificata", codiciLEA: ["06.12.12.048 1950", "06.12.91.499 66,50", "06.12.91.433 40", "06.12.91.436 21,30 (x4)", "06.12.91.517 21", "06.12.91.457 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi Arti inferiori", patologie: "Esiti di PAA, emiplegie, diplegie, mielomeningocole, paralisi cerebrale infantile."},
          { prodotto: "RGO (Tutore Tronco - anca - coscia -gamba - piede)", marca: "Non specificata", codiciLEA: ["06.12.18.015 5920", "06.12.91.493 470 (x2)", "06.12.91.457 225 (x4)", "06.12.91.430 30 (x2)", "06.12.91.439 142,40 (x2)", "06.12.91.436 21,30 (x8)", "06.12.91.445 31,10 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi tronco- arti inferiori.", patologie: "Lesioni midollari, paraplegie congenite patologiche, spina bifida, poliomielite, distrofia muscolare, mielomeningocele."},
          { prodotto: "Neuro Swing (fior e gentz) (Tutore Gamba piede articolato in carbonio)", marca: "Non specificata", codiciLEA: ["06.12.06.027 543", "06.12.91.514 50", "06.12.91.433 40", "06.12.91.439 142,40", "06.12.91.418 70 (x25)", "06.12.91.445* 31,10", "06.12.91.412 120 (x2)", "06.12.91.424 70", "06.12.91.523 173,90"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "Paralisi cerebrali infantili, mielomeningocele e lesioni midollari livello S1-S2- forme diplegiche distali o prossimali, emiplegie, stroke, ТВІ."},
          { prodotto: "Neuro swing (kafo) (Tutore Coscia Gamba Piede)", marca: "Non specificata", codiciLEA: ["06.12.12.048 1950", "06.12.91.499 66,50", "06.12.91.433 40", "06.12.91.436 21,30 (x4)", "06.12.91.517 21", "06.12.91.463 260", "06.12.91.439 142,40", "06.12.91.418 70 (x50)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi Arti inferiori", patologie: "Limitazione degli estensori di ginocchio"},
          { prodotto: "Salera (Tutore Tronco - anca - coscia -gamba - piede)", marca: "Non specificata", codiciLEA: ["06.12.12.048 1500 (x2)", "06.12.91.424 70 (x2)", "06.12.91.517 21 (x2)", "06.12.91.430 30 (x2)", "06.12.91.433 40 (x2)", "06.12.91.436* 21,30 (x6)", "06.12.91.439 142,40 (x2)", "06.12.91.445* (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi tronco- arti inferiori.", patologie: "Mielomeningocele e lesioni midollari corrispondenti o superiori al livello L2-L3."},
          { prodotto: "Doccia di posizione avambraccio- mano", marca: "Non specificata", codiciLEA: ["06.06.13.018 325", "06.06.91.106 125,50 (x2)", "06.06.91.215 25"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi arto superiore", patologie: "Mantenimento mano in posizione funzionale, caduta in flessione flaccida o spastica, trattamento deformità."},
          { prodotto: "Tutore d'anca (Swash)", marca: "Swash", codiciLEA: ["06.12.15.042 760x2 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi d'anca", patologie: "Non specificata"},
          { prodotto: "Scarpe su misura basse per plantari", marca: "Non specificata", codiciLEA: ["06.33.07.003 (x2)", "06.33.91.148 (x2)", "06.12.03.042 (x2)", "06.12.91.103 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "Deformità del piede"},
          { prodotto: "Scarpe su misura alte per plantari", marca: "Non specificata", codiciLEA: ["06.33.07.006 (x2)", "06.33.91121 (x2)", "06.33.91.148 (x2)", "06.12.03.042 (x2)", "06.12.91.103 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "Deformità del piede"},
          { prodotto: "Scarpe di rivestimento su misura bassa", marca: "Non specificata", codiciLEA: ["06.33.21.009 (x2)", "06.33.91.148 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Non specificata", patologie: "Deformità del piede"},
          { prodotto: "Scarpe di rivestimento su misura alta", marca: "Non specificata", codiciLEA: ["06.33.21.012 (x2)", "063391121 (x2)", "06.33.91.148 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Non specificata", patologie: "Deformità del piede"},
          { prodotto: "Scarpe di rivestimento su misura bassa con rialzo fino a 2 cm", marca: "Non specificata", codiciLEA: ["06.33.21.021 (x2)", "06.33.91.148 (x2)", "063391106 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "Deformità del piede"},
          { prodotto: "Scarpe di rivestimento su misura alta con rialzo fino a 2 cm", marca: "Non specificata", codiciLEA: ["06.33.21.024 (x2)", "063391124 (x2)", "06.33.91.148 (x2)", "063391106 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "Deformità del piede"},
          { prodotto: "Scarpe di rivestimento su misura alta con rialzo da 2 a 4 cm", marca: "Non specificata", codiciLEA: ["06.33.21.030 (x2)", "063391121 (x2)", "06.33.91.148 (x2)", "06.33.91.118 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "deformità del piede, eterometria arti inferiore"},
          { prodotto: "Scarpe di rivestimento su misura alta Con rialzo da 4 a 8 cm", marca: "Non specificata", codiciLEA: ["06.33.21.033 (x2)", "063391121 (x2)", "06.33.91.148 (x2)", "06.33.91.118 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "deformità del piede, eterometria arti inferiore"},
          { prodotto: "Scarpe di rivestimento su misura alta Con rialzo oltre gli 8 cm", marca: "Non specificata", codiciLEA: ["06.33.21.036 (x2)", "063391121 (x2)", "06.33.91.148 (x2)", "06.33.91.118 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "deformità del piede, eterometria arti inferiori"},
          { prodotto: "Calzature su misura per patologie complesse Piede equino, varo, supinato, addotto", marca: "Non specificata", codiciLEA: ["06.33.05.003 (x2)", "06.33.91.106 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Ortesi arto inferiori", patologie: "Non specificata"},
          { prodotto: "Calzatura su misura con avampiede bassa", marca: "Non specificata", codiciLEA: ["06.33.05.006 (x2)", "06.33.91.148 (x2)", "06.12.03.042 (x2)", "06.12.91.103 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Non specificata", patologie: "Non specificata"},
          { prodotto: "Calzatura su misura con avampiede alta", marca: "Non specificata", codiciLEA: ["06.33.05.009 (x2)", "063391121 (x2)", "06.33.91.148 (x2)", "06.12.03.042 (x2)", "06.12.91.103 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "Non specificata", patologie: "Non specificata"},
          { prodotto: "Protesi Provvisoria Modulare transtibiale", marca: "Non specificata", codiciLEA: ["06.24.09.033", "06.24.91.121", "062491239", "06.24.91.224", "06.24.91.242", "06.24.91.233"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi definitiva Modulare Transtibiale", marca: "Non specificata", codiciLEA: ["06.24.09.039", "06.24.91.224", "06.24.91.239", "06.24.91.242", "06.24.91.233", "062491121"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi modulare Transtibiale da bagno", marca: "Non specificata", codiciLEA: ["06.24.09.045", "06.24.91.224", "06.24.91.239", "06.24.91.242", "06.24.91.233", "06.24.91.121"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi modulare provvisoria Transfermorale", marca: "Non specificata", codiciLEA: ["06.24.15.030", "06.24.91.224 (x2)", "062491121", "06.24.91.330", "06.24.91.245", "06.24.91.324"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfemorale definitiva", marca: "Non specificata", codiciLEA: ["06.24.15.036", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfermorale Definitiva con invasatura con aderenza totale e tenuta pneumatica: ginocchio monocentrico...", marca: "Non specificata", codiciLEA: ["06.24.15.042", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfermorale Definitiva con invasatura con aderenza totale e tenuta pneumatica: ginocchio policentrico...", marca: "Non specificata", codiciLEA: ["06.24.15.048", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfermorale Definitiva con invasatura con aderenza totale e tenuta pneumatica: ginocchio idraulico o pneumatico...", marca: "Non specificata", codiciLEA: ["06.24.15.054", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfermorale Definitiva con invasatura con aderenza totale e tenuta pneumatica: ginocchio polifunzionale monocentrico a frizione...", marca: "Non specificata", codiciLEA: ["06.24.15.057", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfermorale Definitiva con invasatura con aderenza totale e tenuta pneumatica: ginocchio polifunzionale policentrico pneumatico...", marca: "Non specificata", codiciLEA: ["06.24.15.060", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfermorale Definitiva con invasatura con aderenza totale e tenuta pneumatica: ginocchio polifunzionale monocentrico con freno automatico...", marca: "Non specificata", codiciLEA: ["06.24.15.063", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Transfermorale Definitiva con invasatura con aderenza totale e tenuta pneumatica: ginocchio con bloccaggio manuale in acciaio...", marca: "Non specificata", codiciLEA: ["06.24.15.069", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi Modulare Definitiva transfemorale da bagno", marca: "Non specificata", codiciLEA: ["06.24.15.081", "06.24.91.224", "06.24.91.339", "06.24.91.330", "06.24.91.245", "06.24.91.324", "062491124", "062491106"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto inferiore", patologie: "Non specificata"},
          { prodotto: "Protesi estetica transradiale", marca: "Non specificata", codiciLEA: ["061809018 1413,20", "061891109 106,00", "061891115 197,50"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto superiore", patologie: "Non specificata"},
          { prodotto: "Protesi mioelettrica transradiale", marca: "Non specificata", codiciLEA: ["61809069", "061891109", "061891115"], tipoDispositivo: "Su Misura", categoriaOrtesi: "protesi arto superiore", patologie: "Non specificata"},
          { prodotto: "Tutore elastico S.El.Li per pollice dita escluse (Palmare)", marca: "Non specificata", codiciLEA: ["06.06.13.015", "06.06.91.106"], tipoDispositivo: "Su Misura", categoriaOrtesi: "arto superiore", patologie: "Paramorfismi e dismorfismi di tipo neurogeno e neuromuscolare, in presenza di un deficit di tipo posturale."},
          { prodotto: "Tutore Elastico S.EI.Li per polso con pollice e dita escluse (Palmare)", marca: "Non specificata", codiciLEA: ["06.06.13.015", "06.06.91.106 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "arto superiore", patologie: "Non specificata"},
          { prodotto: "Tutore Elastico S. El. Li per avambraccio polso, mano e dita (Palmare)", marca: "Non specificata", codiciLEA: ["06.06.13.012", "06.06.91.106 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "arto superiore", patologie: "Non specificata"},
          { prodotto: "tutore elastico S. El. Li per gomito e avambraccio (gomitiera)", marca: "Non specificata", codiciLEA: ["06.06.12.003"], tipoDispositivo: "Su Misura", categoriaOrtesi: "arto superiore", patologie: "Non specificata"},
          { prodotto: "tutore elastico S. El. Li per avambraccio polso mano (tutore avambraccio mano)", marca: "Non specificata", codiciLEA: ["06.06.13.012", "06.06.91.106 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "arto superiore", patologie: "Non specificata"},
          { prodotto: "Tutore Elastico S. El. Li di tronco con spalle incluse (tutore di tronco)", marca: "Non specificata", codiciLEA: ["06.03.18.033"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi di tronco", patologie: "Non specificata"},
          { prodotto: "Tutore Elastico S. El. Li di tronco con spalle incluse e prolungamento sacro ischiatica (tutore di tronco)", marca: "Non specificata", codiciLEA: ["06.03.18.033", "06.03.91.715"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi di tronco", patologie: "Non specificata"},
          { prodotto: "Tutore Elastico S. El. Li di tronco con presa scapolo-omerale (tutore di tronco)", marca: "Non specificata", codiciLEA: ["06.03.18.033", "06.03.91.721 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi di tronco", patologie: "Non specificata"},
          { prodotto: "Tutore Elastico S. El. Li di tronco con presa scapolo-omerale e prolungamento sacro ischiatico (tutore di tronco)", marca: "Non specificata", codiciLEA: ["06.03.18.033", "06.03.91.715", "06.03.91.721 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi di tronco", patologie: "Non specificata"},
          { prodotto: "Tutore elastico S. El. Li di tronco con prolungamento alle cosce (tutore di tronco)", marca: "Non specificata", codiciLEA: ["06.03.18.033", "06.03.91.715", "06.03.91.718"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi di tronco", patologie: "Non specificata"},
          { prodotto: "Tutore Elastico S. El. Li di tronco con presa scapolo-omerale e prolungamento sacro ischiatico (con prolungamento alle cosce)", marca: "Non specificata", codiciLEA: ["06.03.18.033", "06.03.91.715", "06.03.91.718", "06.03.91.724 (x2)"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi di tronco", patologie: "Non specificata"},
          { prodotto: "Tutore Elastico S. El. Li abduttore per bacino e cosce (tutore bacino)", marca: "Non specificata", codiciLEA: ["06.12.15.009"], tipoDispositivo: "Su Misura", categoriaOrtesi: "ortesi d'anca", patologie: "Non specificata"}
        ];

        const devicesContainerSerieEl = document.getElementById('devicesContainerSerie');
        const devicesContainerSuMisuraEl = document.getElementById('devicesContainerSuMisura');
        const searchInputEl = document.getElementById('searchInput');
        const noResultsSerieEl = document.getElementById('noResultsSerie');
        const noResultsSuMisuraEl = document.getElementById('noResultsSuMisura');
        const noResultsGlobalEl = document.getElementById('noResultsGlobal');

        const toggleSerieEl = document.getElementById('toggleSerie');
        const toggleSuMisuraEl = document.getElementById('toggleSuMisura');
        const devicesContainerSerieWrapperEl = document.getElementById('devicesContainerSerieWrapper');
        const devicesContainerSuMisuraWrapperEl = document.getElementById('devicesContainerSuMisuraWrapper');
        
        function highlightText(text, query) {
            if (!text) return '';
            if (!query || query.length < 1) return text;
            try {
                // Sanitize query for regex: escape special characters
                const sanitizedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(`(${sanitizedQuery})`, 'gi');
                return text.replace(regex, '<span class="highlight">$1</span>');
            } catch (e) {
                console.error("Errore nella regex per l'highlight:", e);
                return text; // Return original text in case of error
            }
        }
        
        function createDeviceCard(device, query = "") {
            const card = document.createElement('div');
            card.className = 'device-card bg-white p-5 rounded-xl shadow-lg hover:shadow-xl border border-gray-200';

            let marcaHtml = '';
            if (device.marca && device.marca !== "Non specificata") {
                marcaHtml = `<p class="text-sm text-sky-600 font-semibold mb-1">Marca: ${highlightText(device.marca, query)}</p>`;
            } else {
                marcaHtml = `<p class="text-sm text-gray-500 italic mb-1">Marca non specificata</p>`;
            }

            const codiciHtml = device.codiciLEA.map(codice =>
                `<li class="text-xs sm:text-sm text-gray-700">${highlightText(codice, query)}</li>`
            ).join('');

            let patologieHtml = '';
            if (device.patologie && device.patologie !== "Non specificata") {
                patologieHtml = `<p class="text-xs text-gray-500 mt-2">Patologie: ${highlightText(device.patologie, query)}</p>`;
            }
            
            let categoriaOrtesiHtml = '';
            if (device.categoriaOrtesi && device.categoriaOrtesi !== "Non specificata") {
                 categoriaOrtesiHtml = `<p class="text-xs text-gray-500 mt-1">Categoria: ${highlightText(device.categoriaOrtesi, query)}</p>`;
            }
            
            let mainContent = `
                <h3 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2">${highlightText(device.prodotto, query)}</h3>
                ${marcaHtml}
                <p class="text-sm sm:text-md font-medium text-gray-700 mt-3 mb-1">Codici Nuovi LEA:</p>
                <ul class="list-disc list-inside space-y-1 text-xs sm:text-sm">
                    ${codiciHtml}
                </ul>
                ${categoriaOrtesiHtml}
                ${patologieHtml}
            `;
            const contentWrapper = document.createElement('div');
            contentWrapper.innerHTML = mainContent;
            card.appendChild(contentWrapper);
            return card;
        }

        function displayDevices(query = "") {
            const lowerCaseQuery = query.toLowerCase().trim();
            
            const filteredDevices = allDevicesData.filter(device => {
                const prodottoMatch = device.prodotto.toLowerCase().includes(lowerCaseQuery);
                const marcaMatch = device.marca && device.marca.toLowerCase().includes(lowerCaseQuery);
                const codiciMatch = device.codiciLEA.some(codice => codice.toLowerCase().includes(lowerCaseQuery));
                const tipoMatch = device.tipoDispositivo && device.tipoDispositivo.toLowerCase().includes(lowerCaseQuery);
                const categoriaMatch = device.categoriaOrtesi && device.categoriaOrtesi.toLowerCase().includes(lowerCaseQuery);
                const patologieMatch = device.patologie && device.patologie.toLowerCase().includes(lowerCaseQuery);
                return prodottoMatch || marcaMatch || codiciMatch || tipoMatch || categoriaMatch || patologieMatch;
            });

            const serieDevices = filteredDevices.filter(d => d.tipoDispositivo === "Di Serie");
            const suMisuraDevices = filteredDevices.filter(d => d.tipoDispositivo === "Su Misura");

            devicesContainerSerieEl.innerHTML = '';
            devicesContainerSuMisuraEl.innerHTML = '';

            serieDevices.forEach(device => devicesContainerSerieEl.appendChild(createDeviceCard(device, query)));
            suMisuraDevices.forEach(device => devicesContainerSuMisuraEl.appendChild(createDeviceCard(device, query)));

            noResultsSerieEl.classList.toggle('hidden', serieDevices.length > 0 || (serieDevices.length === 0 && suMisuraDevices.length > 0 && query !== ""));
            noResultsSuMisuraEl.classList.toggle('hidden', suMisuraDevices.length > 0 || (suMisuraDevices.length === 0 && serieDevices.length > 0 && query !== ""));
            
            noResultsGlobalEl.classList.toggle('hidden', filteredDevices.length > 0 || query === "");

             if (query === "") {
                 noResultsSerieEl.classList.add('hidden');
                 noResultsSuMisuraEl.classList.add('hidden');
            }
        }
        
        function setupCollapsibleSections() {
            // Funzione per gestire il toggle di una singola sezione
            const toggleSection = (toggleElement, containerWrapperElement) => {
                containerWrapperElement.classList.toggle('hidden');
                toggleElement.classList.toggle('collapsed');
            };

            // Aggiungi event listener
            toggleSerieEl.addEventListener('click', () => toggleSection(toggleSerieEl, devicesContainerSerieWrapperEl));
            toggleSuMisuraEl.addEventListener('click', () => toggleSection(toggleSuMisuraEl, devicesContainerSuMisuraWrapperEl));

            // Imposta le sezioni come collassate all'inizio
            if (!devicesContainerSerieWrapperEl.classList.contains('hidden')) {
                toggleSection(toggleSerieEl, devicesContainerSerieWrapperEl);
            }
            if (!devicesContainerSuMisuraWrapperEl.classList.contains('hidden')) {
                toggleSection(toggleSuMisuraEl, devicesContainerSuMisuraWrapperEl);
            }
        }

        searchInputEl.addEventListener('input', function() {
            displayDevices(this.value);
        });

        // Inizializzazione
        displayDevices(); // Mostra tutti i dispositivi (ma le sezioni saranno collassate)
        setupCollapsibleSections(); // Imposta le sezioni come collassate e aggiunge i listener
    </script>
</body>
</html>
